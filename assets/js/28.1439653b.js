(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{320:function(t,s,a){"use strict";a.r(s);var n=a(13),r=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"react-项目单元测试技术方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react-项目单元测试技术方案"}},[t._v("#")]),t._v(" react 项目单元测试技术方案")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/365160/1628517126934-c513f0ef-8cf8-40ad-af78-8d4f7d94de7a.png#clientId=u06b74433-ee40-4&from=paste&id=u11a75c68&margin=%5Bobject%20Object%5D&name=image.png&originHeight=400&originWidth=720&originalType=binary&ratio=1&size=45269&status=done&style=shadow&taskId=u45c238dc-d374-4f96-ad61-936cb3207a6",alt:"image.png"}}),t._v("\n​")]),t._v(" "),s("h2",{attrs:{id:"why"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#why"}},[t._v("#")]),t._v(" Why")]),t._v(" "),s("p",[t._v("The more your tests resemble the way your software is used, the more confidence they can give you.")]),t._v(" "),s("h2",{attrs:{id:"背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),s("p",[t._v("该项目是用 umi 框架搭建，其自身内置了 jest 测试框架")]),t._v(" "),s("ul",[s("li",[t._v("umi 内置的 jest 配置")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("collectCoverageFrom")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.{js,jsx,ts,tsx}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      hasSrc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/**/*.{js,jsx,ts,tsx}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      isLerna "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("package "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'packages/*/src/**/*.{js,jsx,ts,tsx}'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      isLerna "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("package "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("packages/")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("package"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("/src/**/*.{js,jsx,ts,tsx}")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'!**/typings/**'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'!**/types/**'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'!**/fixtures/**'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'!**/examples/**'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'!**/*.d.ts'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Boolean"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("moduleFileExtensions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ts'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tsx'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("moduleNameMapper")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'\\\\.(css|less|sass|scss|stylus)$'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" require"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'identity-obj-proxy'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("setupFiles")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("require"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../helpers/setupFiles/shim'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("setupFilesAfterEnv")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("require"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../helpers/setupFiles/jasmine'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("testEnvironment")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" require"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jest-environment-jsdom-fourteen'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("testMatch")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("testMatchPrefix"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("**/?*.(")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("testMatchTypes"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'|'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v(").(j|t)s?(x)")]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("testPathIgnorePatterns")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/node_modules/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/fixtures/'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("transform")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'^.+\\\\.(js|jsx|ts|tsx)$'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" require"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../helpers/transformers/javascript'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'^.+\\\\.(css|less|sass|scss|stylus)$'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" require"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../helpers/transformers/css'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'^(?!.*\\\\.(js|jsx|ts|tsx|css|less|sass|scss|stylus|json)$)'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" require"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../../helpers/transformers/file'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("verbose")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("transformIgnorePatterns")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 加 [^/]*? 是为了兼容 tnpm 的目录结构")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 比如：_umi-test@1.5.5@umi-test")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// `node_modules/(?!([^/]*?umi|[^/]*?umi-test)/)`,")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 用于设置 jest worker 启动的个数")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MAX_WORKERS")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("maxWorkers")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Number")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MAX_WORKERS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("ul",[s("li",[t._v("合并配置部分代码如下：")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" config "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mergeConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDefaultConfig")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cwd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" args"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  packageJestConfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  userJestConfig\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("其源码在此："),s("a",{attrs:{href:"https://github.com/umijs/umi/blob/master/packages/test/src/createDefaultConfig/createDefaultConfig.ts",target:"_blank",rel:"noopener noreferrer"}},[t._v("点击跳转"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"技术栈选择"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#技术栈选择"}},[t._v("#")]),t._v(" 技术栈选择")]),t._v(" "),s("p",[t._v("由于 umi 内置的 jest 配置是不能满足我们项目的需求的，jest 是 JavaScript 的测试框架，如果需要对 dom 做单元测试，需要引入更多测试库")]),t._v(" "),s("h3",{attrs:{id:"jest"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jest"}},[t._v("#")]),t._v(" Jest")]),t._v(" "),s("p",[t._v("jest 是 umi 自带的，这个是基础，需要对其有基本的认识，其文档如下：\n"),s("a",{attrs:{href:"https://jestjs.io/zh-Hans/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://jestjs.io/zh-Hans/"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"ts-jest"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ts-jest"}},[t._v("#")]),t._v(" ts-jest")]),t._v(" "),s("p",[t._v("ts-jest 是让我们能用 Typescript 写测试代码的转换工具，也是 umi 内置配置，很少需要更改，如需更改可参考官方文档：\n"),s("a",{attrs:{href:"https://kulshekhar.github.io/ts-jest/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://kulshekhar.github.io/ts-jest/docs/"),s("OutboundLink")],1)]),t._v(" "),s("h3",{attrs:{id:"react-testing-library"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react-testing-library"}},[t._v("#")]),t._v(" React Testing Library")]),t._v(" "),s("p",[t._v("React Testing Library 是 测试 React 组件的解决方案，其包含了 React 官方的测试工具 react-dom/test-utils 的 API，也是 React 官方推荐的测试 DOM 库。\n至于为什么不用老牌测试库 Enzyme ,可以看作者的 blog 这篇文章：\n"),s("a",{attrs:{href:"https://kentcdodds.com/blog/introducing-the-react-testing-library",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://kentcdodds.com/blog/introducing-the-react-testing-library"),s("OutboundLink")],1),t._v(" "),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/210656/1627278840847-6381bcd3-21a2-4ea1-961f-a6279c9bf46a.png#clientId=u4ea35102-efdf-4&from=paste&height=221&id=u11da665c&margin=%5Bobject%20Object%5D&name=Untitled.png&originHeight=221&originWidth=797&originalType=binary&ratio=1&size=37038&status=done&style=none&taskId=u600b1086-55cb-47ce-a093-ea6b1003159&width=797",alt:"Untitled.png"}}),t._v("\n平时写测试代码时更多接触的是 React Testing Library ,其文档如下：\n"),s("a",{attrs:{href:"https://testing-library.com/docs/react-testing-library/intro",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://testing-library.com/docs/react-testing-library/intro"),s("OutboundLink")],1),t._v("\n除了 @testing-library/react 外，平时@testing-library 旗下的其他库，例如 @testing-library/user-event 用来模拟交互的。 @testing-library/react 是基于 @testing-library/dom 的，所以对 @testing-library/dom 有基本的了解，有助于深入理解@testing-library/react")]),t._v(" "),s("h3",{attrs:{id:"mock-service-worker"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mock-service-worker"}},[t._v("#")]),t._v(" Mock Service Worker")]),t._v(" "),s("p",[t._v("Mock Service Worker (MSW) 是用来 mock Axios 的请求结果的， 执行 REST/GraphQL API\n其文档如下："),s("a",{attrs:{href:"https://github.com/mswjs/msw",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/mswjs/msw"),s("OutboundLink")],1)]),t._v(" "),s("h2",{attrs:{id:"使用引导"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用引导"}},[t._v("#")]),t._v(" 使用引导")]),t._v(" "),s("h3",{attrs:{id:"单元测试编写"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#单元测试编写"}},[t._v("#")]),t._v(" 单元测试编写")]),t._v(" "),s("p",[t._v("这里不做过多介绍，可以参考官方 example 及其他指导文章，以及现有的单元测试代码，分享一下如下几篇")]),t._v(" "),s("ol",[s("li",[t._v("官方 demo： "),s("a",{attrs:{href:"https://testing-library.com/docs/react-testing-library/example-intro",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://testing-library.com/docs/react-testing-library/example-intro"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("作者 blog—Common mistakes with React Testing Library — "),s("a",{attrs:{href:"https://kentcdodds.com/blog/common-mistakes-with-react-testing-library",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://kentcdodds.com/blog/common-mistakes-with-react-testing-library"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("测试 react-toolkit — "),s("a",{attrs:{href:"https://ogzhanolguncu.com/blog/testing-react-redux-toolkit-with-typescript",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://ogzhanolguncu.com/blog/testing-react-redux-toolkit-with-typescript"),s("OutboundLink")],1)])]),t._v(" "),s("p",[t._v("注：写单元测试能够加深你对代码的理解以及对自己代码的信任度")]),t._v(" "),s("h3",{attrs:{id:"运行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[t._v("#")]),t._v(" 运行")]),t._v(" "),s("p",[t._v("单元测试环境已经搭建好了，只需要执行对应的命名就可以了")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"test"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"umi test --no-cache"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一次性执行单元测试")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"test:watch"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"umi test --watch"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 实时监听代码变动，执行")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"test:clear"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"umi test --clearCache"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"test:coverage"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"umi test --coverage"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 执行，输出覆盖报告")]),t._v("\n")])])]),s("h3",{attrs:{id:"配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),s("p",[t._v("有些情况现有的配置不能满足自己的需求，可以根据情况更改配置")]),t._v(" "),s("ol",[s("li",[t._v("jest.config.js")]),t._v(" "),s("li",[t._v("./src/setupTests.ts")])]),t._v(" "),s("h3",{attrs:{id:"覆盖率"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#覆盖率"}},[t._v("#")]),t._v(" 覆盖率")]),t._v(" "),s("p",[t._v("使用了 Istanbul 代码覆盖工具，关于覆盖指标参考：\n阮一峰这篇文章 — "),s("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2015/06/istanbul.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://www.ruanyifeng.com/blog/2015/06/istanbul.html"),s("OutboundLink")],1),t._v("\n目前项目确定如下的覆盖目标：")]),t._v(" "),s("div",{staticClass:"language-jsx extra-class"},[s("pre",{pre:!0,attrs:{class:"language-jsx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("global")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("branches")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("functions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("lines")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("statements")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("p",[t._v("使用 "),s("code",[t._v("yarn test:coverage")]),t._v(" 可以测试输出覆盖率报告")]),t._v(" "),s("h3",{attrs:{id:"踩坑过程问题记录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#踩坑过程问题记录"}},[t._v("#")]),t._v(" 踩坑过程问题记录")]),t._v(" "),s("p",[t._v("记录一些问题：以防重复踩坑")]),t._v(" "),s("ol",[s("li",[s("a",{attrs:{href:"https://stackoverflow.com/questions/39830580/jest-test-fails-typeerror-window-matchmedia-is-not-a-function",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jest test fails : TypeError: window.matchMedia is not a function"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://stackoverflow.com/questions/55181009/jest-react-testing-library-warning-update-was-not-wrapped-in-act",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jest + react-testing-library: Warning update was not wrapped in act()"),s("OutboundLink")],1)]),t._v(" "),s("li",[t._v("Uncaught [Error: Invalid hook call. Hooks can only be called inside of the body of a function component — mock module 在 setupTests.ts 中引入")]),t._v(" "),s("li",[t._v("The module factory of jest.mock() is not allowed to reference any out-of-scope variable — 用 require 在里面解决,参考:"),s("a",{attrs:{href:"https://github.com/facebook/jest/issues/2567",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/facebook/jest/issues/2567"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"后续计划"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#后续计划"}},[t._v("#")]),t._v(" 后续计划")]),t._v(" "),s("ol",[s("li",[t._v("抽离公共测试代码，使写单测更加丝滑")]),t._v(" "),s("li",[t._v("补充单元测试，满足覆盖率指标")]),t._v(" "),s("li",[t._v("端对端测试搞起来")]),t._v(" "),s("li",[t._v("接入到 CI/CD 中")])])])}),[],!1,null,null,null);s.default=r.exports}}]);