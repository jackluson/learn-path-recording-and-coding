(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{319:function(t,s,e){"use strict";e.r(s);var a=e(13),r=Object(a.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"如何引进-typescript-到现存-vue-cli3-项目中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何引进-typescript-到现存-vue-cli3-项目中"}},[t._v("#")]),t._v(" 如何引进 Typescript 到现存 Vue-cli3+项目中")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2021/png/365160/1628517679069-6d107ddb-1b56-4b1d-bea6-481863c9f3f1.png#clientId=uee6969e3-26f5-4&from=paste&height=421&id=ub085a507&margin=%5Bobject%20Object%5D&name=image.png&originHeight=439&originWidth=750&originalType=binary&ratio=1&size=25839&status=done&style=none&taskId=u16571b65-f7b7-4a90-b564-6ce970171a1&width=720",alt:"image.png"}})]),t._v(" "),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),s("p",[t._v("在把项目改造支持 Typescript 之后, 跑了几个迭代,也踩了一些坑。还好这些坑总体可控， 没翻车， 所以就写篇文章分享一下， 如果想要体验 vue+typescript 的同学可以看看。\n之前配置的过程查找了很多资料，但大部分都是下面两种方案：")]),t._v(" "),s("ul",[s("li",[t._v("基于 vue-cli3+的全新的项目")]),t._v(" "),s("li",[t._v("vue-cli2 的老项目引进 typescript")])]),t._v(" "),s("p",[t._v("但是我们公司的项目在新建项目的时候并没有引入 typescript 的支持。如果后期想引入 typescript 呢，有没有一种**向后兼容（backward compatibility）**的方式整合到现有的项目中呢，既可支持 ts，也可以兼容 js，这样现有的代码就几乎不用改动了。\n下面分三部分来描述 👇：")]),t._v(" "),s("ul",[s("li",[t._v("一个基于 vue-cli3+、支持 typescript 的新项目是怎么配置的？")]),t._v(" "),s("li",[t._v("如何应用这些不同的配置到现存的项目中？")]),t._v(" "),s("li",[t._v("因为子项目需要引入主模块的 app，还有 vue，element-ui 等等是以 extenal 引进来的，这些需要如何配置才不使 ts 报错？")])]),t._v(" "),s("h2",{attrs:{id:"_1-一个基于-vue-cli3-、支持-typescript-的新项目是怎么配置的"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-一个基于-vue-cli3-、支持-typescript-的新项目是怎么配置的"}},[t._v("#")]),t._v(" 1. 一个基于 vue-cli3+、支持 typescript 的新项目是怎么配置的？")]),t._v(" "),s("blockquote",[s("p",[t._v("开始之前，我们先了解一下 Typescript 是什么？为什么需要它，能给项目带来什么？(如果熟悉 typescript 的话，这部分可以跳过哈)")])]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("Typescript 是 JavaScript 的超集")])])]),t._v(" "),s("p",[t._v('正如官方说描述: "A superset of Javascript"， Typescript 更接近面对对象语言， 支持更多的 JS 不能支持的语法：\n例如，链式语法， '),s("code",[t._v("js: res && res.data && res.data.name")]),t._v(" ; ts 的话： "),s("code",[t._v("res?.data?.name")]),t._v("  虽然 babel 也有类似的插件实现该语法 。\n而且 ts 是向后兼容的, 也就 js 的语法都可以直接在 ts 都可以运用。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("更严谨，能提前避免一些 bug 出现， 同时有利后期项目的维护")])])]),t._v(" "),s("p",[t._v("js 是解析式弱类型语言。比如，js 很多情况存在隐形转换，但是又是在运行时才报错, 这无疑给我们埋了很多未知的坑,特别是在一些大型项目中,所以一些大型项目都投入 ts 的怀抱，例如"),s("a",{attrs:{href:"https://github.com/ant-design/ant-design",target:"_blank",rel:"noopener noreferrer"}},[t._v("ant-design"),s("OutboundLink")],1),t._v("、"),s("a",{attrs:{href:"https://github.com/microsoft/vscode",target:"_blank",rel:"noopener noreferrer"}},[t._v("vscode"),s("OutboundLink")],1),t._v("、 还有即将发布的 vue3 版本"),s("a",{attrs:{href:"https://github.com/vuejs/vue-next",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-next"),s("OutboundLink")],1),t._v("。 ts 是要编译成 js 才能在浏览器中执行的， 所以在编译过程中可以提示我们很多可能出现错误的地方， 我们以此纠正。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("更好的开发体验")])])]),t._v(" "),s("p",[t._v("这个主要是编辑器更智能，更友好的提示。 我们现在的编辑器提示功能主要是借助一些 Snippets 插件实现的， 但是 ts 的 xx.d.ts 的声明文章对编辑器来说更智能，更友好。可以说申明文件写的越完整，编辑器越智能，例如\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2020/png/365160/1597042737532-dbed3c63-e722-47b8-bf46-ba714e6fae61.png#height=137&id=kYepm&margin=%5Bobject%20Object%5D&name=image.png&originHeight=137&originWidth=573&originalType=binary&ratio=1&size=7982&status=done&style=none&width=573",alt:"image.png"}})]),t._v(" "),s("blockquote",[s("p",[t._v("现在很多 npm 包都有了自己的 typescript 声明文件了, 没有的话可以在"),s("a",{attrs:{href:"https://github.com/DefinitelyTyped/DefinitelyTyped",target:"_blank",rel:"noopener noreferrer"}},[t._v("DefinitelyTyped"),s("OutboundLink")],1),t._v('上面找找, 或者自己写声明文件, 例如上面我写的"app"')])]),t._v(" "),s("div",{staticClass:"language-typescript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-typescript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("declare")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("module")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"app"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" Store"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Module "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"vuex"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" IState "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"@/store"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("type")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SubModuleOptions")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    store"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Module"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("IState"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//TODO:Module<S, R> 中的R指的是rootState, 应该app主项目还没改造成typescript, 先用any")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("generator")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("Vue"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("registerModule")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("subModuleOptions"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" SubModuleOptions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" system"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" System"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" utils"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Record"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" config"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Record"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" request"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Record"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" router"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Record"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("any")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" store"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Store"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("IState"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("更多关于 ts 的知识，请查看官方文档"),s("a",{attrs:{href:"https://www.typescriptlang.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.typescriptlang.org/"),s("OutboundLink")],1),t._v(",网上也有很多文章描述采用 ts 的优点,缺点。 这里就不再展开了，下面开始我们的正式内容。ヾ(≧▽≦*)o")]),t._v(" "),s("h3",{attrs:{id:"新建一个空的-vue-typescript-的项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建一个空的-vue-typescript-的项目"}},[t._v("#")]),t._v(" 新建一个空的 vue+typescript 的项目")]),t._v(" "),s("p",[t._v("新建一个基于 vue-cli3+的 typescript 项目, 网上有很多这种文档, 比如"),s("a",{attrs:{href:"https://segmentfault.com/a/1190000019905650",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://segmentfault.com/a/1190000019905650"),s("OutboundLink")],1),t._v(", 注意选择 "),s("code",[t._v("Use class-style component syntax?")]),t._v("  的时候我们选择 yes, 因为我们需要用类组件。\n对比与不支持 typescript 的 vue 项目， 新的地方如下：")]),t._v(" "),s("div",{staticClass:"language-powershell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-powershell"}},[s("code",[t._v("├─src\n│  ├─main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ts\n│  ├─shims-tsx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ts\n│  └─shims-vue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("d"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ts\n├─tsconfig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("json\n")])])]),s("p",[t._v("从名字可以看出这几个文件的作用， 但是这里我们先不用理会。 此外当然 package.json 和.eslintrc.js 中的配置也有些差别， 对比发现，其他 package.json 只是多了"),s("code",[t._v("vue-class-component、vue-property-decorator、typescript、@typescript-eslint/parser")]),t._v(" 、@typescript-eslint/parser、@vue/cli-plugin-typescript、@vue/eslint-config-typescript   这几个包。")]),t._v(" "),s("h2",{attrs:{id:"_2-应用这些不同点到现存的项目中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-应用这些不同点到现存的项目中"}},[t._v("#")]),t._v(" 2. 应用这些不同点到现存的项目中")]),t._v(" "),s("p",[t._v("我们要怎样应用这些不同点到现有的项目中呢， 摸着石头过河，我们在同样的目录结构下直接复制这些不同的新文件过来， 然后增加 package.json 不存在的包， 修改 main.js 为 main.ts(这里可能有坑)， 复制.eslintrc.js 配置过来。\n准备好这些之后， 删除 node_modules 重新 "),s("code",[t._v("npm install")]),t._v("  安装一次\n​")]),t._v(" "),s("h2",{attrs:{id:"_3-因地制宜-根据项目具体情况配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-因地制宜-根据项目具体情况配置"}},[t._v("#")]),t._v(" 3. 因地制宜，根据项目具体情况配置")]),t._v(" "),s("p",[t._v("直接运行项目的话，可能会报很多类似的？Cannot find module 'xxx' or its corresponding type declarations. 的错误， 这是因为找不到对应报的声明文件。 根据项目的具体情况，例如我们的项目 vue、vuex、element-ui、app 等是通过 externals 方式引入的， 所以在 package.json 中找不到对应的依赖， 这样的话也没有这些包声明文件。还好 vue、vuex、element-ui 是提供声明文件的， 我们只需要把这些包安装成开发依赖 devDependencies ，在后面的开发中我们就可以使用这些声明文件了。 但是 app 是主项目的 umd 包，也是没有申明文件的， 这时候我们就要针对 app 自己写声明文件了。 最简单的就是在 src 目录下新建一个 typings 目录，在创建一个 app.d.ts, "),s("code",[t._v('declare module "app"')]),t._v("  声明就可以了， 这样就不会报错了。 更多申明文件怎么写可以参考"),s("a",{attrs:{href:"https://www.typescriptlang.org/docs/handbook/declaration-files/introduction.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://www.typescriptlang.org/docs/handbook/declaration-files/introduction.html"),s("OutboundLink")],1),t._v(" 。 此外可能还有出现其他的错误， 比如 eslint 错误， 这些要根据具体错误具体解决了。")]),t._v(" "),s("h2",{attrs:{id:"_4-利用-ts-进行业务开发"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-利用-ts-进行业务开发"}},[t._v("#")]),t._v(" 4.利用 ts 进行业务开发")]),t._v(" "),s("p",[t._v("搭建好 ts 的开发环境之后， 因为 ts 是向后兼容的，所以之前的业务代码全部不用改。后面用 ts 开发的话， 学会使用 ts、"),s("a",{attrs:{href:"https://github.com/kaorun343/vue-property-decorator",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-property-decorator"),s("OutboundLink")],1),t._v("和"),s("a",{attrs:{href:"https://github.com/vuejs/vue-class-component",target:"_blank",rel:"noopener noreferrer"}},[t._v("vue-class-component"),s("OutboundLink")],1),t._v("就行了。 后面有机会可以写 tsconfig 的配置， 声明文件， vuex 这些内容了，感谢大家的阅读了， 有问题欢迎沟通哈。")])])}),[],!1,null,null,null);s.default=r.exports}}]);